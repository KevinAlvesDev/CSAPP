


<div class="modal fade" id="modalGamificacao" tabindex="-1" aria-labelledby="modalGamificacaoLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable"> 
        <div class="modal-content" style="background-color: var(--container-bg); color: var(--body-color);">
        
        
        
        
        {% if g.perfil and g.perfil.perfil_acesso == 'Administrador' %}

            
            <form action="{{ url_for('gamification.save_gamification_rules_from_modal') }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="modal-header header-bg">
                    <h5 class="modal-title" id="modalGamificacaoLabel" style="color: var(--body-color);">
                        <i class="bi bi-pencil-square me-2"></i> Editar Pontos da Gamificação
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {% if not g.gamification_rules %}
                        <div class="alert alert-warning">Nenhuma regra de gamificação encontrada no banco de dados. (Execute 'flask init-db')</div>
                    {% endif %}

                    {% for categoria, regras in g.gamification_rules.items() %}
                        <h5 class="mt-3 mb-3 text-primary border-bottom pb-2">{{ categoria }}</h5>
                        
                        {% for regra in regras %}
                        <div class="row mb-2">
                            <label for="regra-{{ regra.regra_id }}" class="col-md-7 col-form-label text-md-end">
                                {{ regra.descricao }}
                            </label>
                            <div class="col-md-5">
                                <div class="input-group">
                                    <input type="number" 
                                           class="form-control" 
                                           id="regra-{{ regra.regra_id }}" 
                                           name="regra-{{ regra.regra_id }}" 
                                           value="{{ regra.valor_pontos }}"
                                           step="1"
                                           required>
                                    
                                    {% set suffix = 'pontos' %}
                                    {% if regra.tipo_valor == 'percentual' %}{% set suffix = '%' %}
                                    {% elif regra.tipo_valor == 'quantidade' %}{% set suffix = 'unid.' %}
                                    {% elif regra.tipo_valor == 'dias' %}{% set suffix = 'dias' %}
                                    {% elif regra.tipo_valor == 'penalidade' %}{% set suffix = 'pontos (negativos)' %}
                                    {% endif %}
                                    
                                    <span class="input-group-text" style="min-width: 130px;">{{ suffix }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% endfor %}
                
                
                <div class="px-3">
                    <hr class="my-3">
                    <h6 class="mb-2">Referência – valores por implantação</h6>
                    <ul class="list-group gamificacao-ref">
                        <li class="list-group-item gamificacao-ref-header">
                            <span class="fw-semibold">Pontos</span>
                            <span class="fw-semibold">Valor por implantação finalizada</span>
                            <span class="fw-semibold">SÊNIOR</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Até 99</span>
                            <span class="text-nowrap">R$ 20,00</span>
                            <span class="text-nowrap">R$ 30,00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Acima de 100</span>
                            <span class="text-nowrap">R$ 120,00</span>
                            <span class="text-nowrap">R$ 140,00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Acima de 150</span>
                            <span class="text-nowrap">R$ 140,00</span>
                            <span class="text-nowrap">R$ 160,00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Acima de 200</span>
                            <span class="text-nowrap">R$ 160,00</span>
                            <span class="text-nowrap">R$ 200,00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Acima de 250</span>
                            <span class="text-nowrap">R$ 180,00</span>
                            <span class="text-nowrap">R$ 220,00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Acima de 300</span>
                            <span class="text-nowrap">R$ 200,00</span>
                            <span class="text-nowrap">R$ 250,00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Bônus extra média trimestre = 330</span>
                            <span class="text-nowrap">R$ 1.000,00 TOTAL</span>
                            <span class="text-nowrap">R$ 1.000,00 TOTAL</span>
                        </li>
                    </ul>
                    <p class="form-text">Informativo para consulta rápida; não altera os valores configurados acima.</p>
                </div>
                </div>
                <div class="modal-footer header-bg"> 
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary"><i class="bi bi-save me-1"></i> Salvar Pontos</button> 
                </div>
            </form>

        {% else %}
            
            <div class="modal-header header-bg">
                <h5 class="modal-title" id="modalGamificacaoLabel" style="color: var(--body-color);">Gamificação - Critérios e Pontuação</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
             <div class="modal-body">
                
                {% if not g.gamification_rules %}
                    <div class="alert alert-info">Carregando regras...</div>
                {% endif %}

                
                
                
                <div class="px-3">
                    <hr class="my-3">
                    <h6 class="mb-2">Referência – valores por implantação</h6>
                    <ul class="list-group gamificacao-ref">
                        <li class="list-group-item gamificacao-ref-header">
                            <span class="fw-semibold">Pontos</span>
                            <span class="fw-semibold">Valor por implantação finalizada</span>
                            <span class="fw-semibold">SÊNIOR</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Até 99</span>
                            <span class="text-nowrap">R$ 20,00</span>
                            <span class="text-nowrap">R$ 30,00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Acima de 100</span>
                            <span class="text-nowrap">R$ 120,00</span>
                            <span class="text-nowrap">R$ 140,00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Acima de 150</span>
                            <span class="text-nowrap">R$ 140,00</span>
                            <span class="text-nowrap">R$ 160,00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Acima de 200</span>
                            <span class="text-nowrap">R$ 160,00</span>
                            <span class="text-nowrap">R$ 200,00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Acima de 250</span>
                            <span class="text-nowrap">R$ 180,00</span>
                            <span class="text-nowrap">R$ 220,00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Acima de 300</span>
                            <span class="text-nowrap">R$ 200,00</span>
                            <span class="text-nowrap">R$ 250,00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Bônus extra média trimestre = 330</span>
                            <span class="text-nowrap">R$ 1.000,00 TOTAL</span>
                            <span class="text-nowrap">R$ 1.000,00 TOTAL</span>
                        </li>
                    </ul>
                    <p class="form-text">Informativo para consulta rápida.</p>
                </div>
             </div> 
             <div class="modal-footer header-bg"> 
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button> 
             </div>
        {% endif %}

        </div> 
    </div>
</div>
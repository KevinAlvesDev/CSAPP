{% extends "base.html" %}

{% block title %}Planos de Sucesso{% endblock %}

{% block head_extra %}
<style>

  .search-filter-bar {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    margin-bottom: 2rem;
  }

  .plano-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border: 2px solid transparent;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .plano-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    border-color: #667eea;
  }

  .plano-card.inactive {
    opacity: 0.6;
    background: #f8f9fa;
  }

  .plano-card-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 1rem;
  }

  .plano-card-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #2d3748;
    margin: 0 0 0.5rem 0;
    flex: 1;
  }

  .plano-status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .plano-status-badge.active {
    background: #d4edda;
    color: #155724;
  }

  .plano-status-badge.inactive {
    background: #f8d7da;
    color: #721c24;
  }

  .plano-description {
    color: #718096;
    font-size: 0.95rem;
    margin-bottom: 1.5rem;
    flex: 1;
    line-height: 1.6;
  }

  .plano-meta {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #e2e8f0;
  }

  .plano-meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: #718096;
  }

  .plano-meta-item i {
    color: #667eea;
  }

  .plano-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .btn-plano {
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.2s ease;
    border: none;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .btn-plano-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }

  .btn-plano-primary:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  .btn-plano-secondary {
    background: #e2e8f0;
    color: #4a5568;
  }

  .btn-plano-secondary:hover {
    background: #cbd5e0;
  }

  .btn-plano-danger {
    background: #fc8181;
    color: white;
  }

  .btn-plano-danger:hover {
    background: #f56565;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .empty-state i {
    font-size: 4rem;
    color: #cbd5e0;
    margin-bottom: 1rem;
  }

  .empty-state h3 {
    color: #4a5568;
    margin-bottom: 0.5rem;
  }

  .empty-state p {
    color: #718096;
    margin-bottom: 1.5rem;
  }

  .planos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
  }

  @media (max-width: 768px) {
    .planos-grid {
      grid-template-columns: 1fr;
    }
  }

  .filter-toggle {
    display: flex;
    gap: 0.5rem;
    background: #f7fafc;
    padding: 0.25rem;
    border-radius: 8px;
  }

  .filter-toggle button {
    flex: 1;
    padding: 0.5rem 1rem;
    border: none;
    background: transparent;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .filter-toggle button.active {
    background: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    color: #667eea;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid p-0">
  <header class="header-bg p-3 d-flex align-items-center position-relative rounded-3">
    <h1 class="main-title mb-0 fs-4 w-100 text-center">CS ONBOARDING Planos de Sucesso</h1>
    <div class="d-flex align-items-center position-absolute end-0 top-50 translate-middle-y gap-2">
      {% if pode_editar %}
      <a href="{{ url_for('planos.novo_plano') }}" class="btn btn-sm btn-primary">
        <i class="bi bi-plus-lg me-1"></i> Novo Plano
      </a>
      {% endif %}
      <a href="{{ url_for('main.dashboard') }}" class="btn btn-sm btn-outline-secondary">
        <i class="bi bi-house me-1"></i> Dashboard
      </a>
    </div>
  </header>
  <main class="p-4" style="padding-top: 20px !important;">


  <div class="search-filter-bar">
    <form method="GET" action="{{ url_for('planos.listar_planos') }}" class="row g-3 align-items-end">
      <div class="col-md-6">
        <label for="busca" class="form-label fw-bold">
          <i class="bi bi-search me-1"></i>Buscar Planos
        </label>
        <input type="text" class="form-control" id="busca" name="busca" placeholder="Digite o nome ou descrição..."
          value="{{ busca or '' }}">
      </div>
      <div class="col-md-4">
        <label class="form-label fw-bold">
          <i class="bi bi-funnel me-1"></i>Status
        </label>
        <div class="filter-toggle">
          <button type="submit" name="ativo" value="true" class="{% if ativo_apenas %}active{% endif %}">
            <i class="bi bi-check-circle me-1"></i>Ativos
          </button>
          <button type="submit" name="ativo" value="false" class="{% if not ativo_apenas %}active{% endif %}">
            <i class="bi bi-archive me-1"></i>Todos
          </button>
        </div>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">
          <i class="bi bi-search me-1"></i>Buscar
        </button>
      </div>
    </form>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  {% for category, message in messages %}
  <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show"
    role="alert">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  {% endfor %}
  {% endif %}
  {% endwith %}

  {% if planos %}
  <div class="planos-grid">
    {% for plano in planos %}
    {% include 'partials/_plano_card.html' %}
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <i class="bi bi-inbox"></i>
    <h3>Nenhum plano encontrado</h3>
    <p>
      {% if busca %}
      Não encontramos planos com os critérios de busca informados.
      {% else %}
      Comece criando seu primeiro plano de sucesso personalizado.
      {% endif %}
    </p>
    {% if pode_editar and not busca %}
    <a href="{{ url_for('planos.novo_plano') }}" class="btn btn-plano btn-plano-primary">
      <i class="bi bi-plus-circle"></i>Criar Primeiro Plano
    </a>
    {% endif %}
  </div>
  {% endif %}
</div>

<div class="modal fade" id="modalExcluirPlano" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">
          <i class="bi bi-exclamation-triangle me-2"></i>Confirmar Exclusão
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="mb-0">Tem certeza que deseja excluir o plano <strong id="planoNomeExcluir"></strong>?</p>
        <p class="text-danger small mt-2 mb-0">
          <i class="bi bi-info-circle me-1"></i>
          Esta ação não pode ser desfeita. O plano só pode ser excluído se não estiver sendo usado em nenhuma
          implantação.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-danger" id="btnConfirmarExclusao">
          <i class="bi bi-trash me-1"></i>Excluir Plano
        </button>
      </div>
    </div>
  </div>
</div>

<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  </main>
</div>
{% endblock %}

{% block scripts_extra %}
<script src="{{ url_for('static', filename='js/planos_sucesso_ui.js') }}"></script>
{% endblock %}